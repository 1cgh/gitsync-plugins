////////////////////////////////////////////////////////////
// Описание пакета для сборки и установки
// Полную документацию см. на hub.oscript.io/packaging
//
Процедура ПередСборкой(Знач РабочийКаталог) Экспорт

	УдалитьФайлы(ОбъединитьПути(РабочийКаталог, "oscript_modules"), "*.*");

	СистемнаяИнформация = Новый СистемнаяИнформация;
	ЭтоWindows = Найти(НРег(СистемнаяИнформация.ВерсияОС), "windows") > 0;
	Если ЭтоWindows Тогда
		ИмяУтилиты = "opm.bat";
	Иначе
		ИмяУтилиты = "opm";
	КонецЕсли;

	СтрокаЗапуска = СтрШаблон("%1 install -l", ИмяУтилиты);
	Процесс = СоздатьПроцесс(СтрокаЗапуска, РабочийКаталог);
	Процесс.Запустить();
	Процесс.ОжидатьЗавершения();
	
	Если Процесс.КодВозврата <> 0 Тогда
		ВызватьИсключение "Ошибка сборки пакета";
	КонецЕсли;
	
КонецПроцедуры

Описание.Имя("gitsync-plugins")
        .Версия("1.0.1")
        .Автор("Khorev A.A. and SiverBulleters")
        .АдресАвтора("khorevaa@gmail.com")
        .Описание("Набор предустановленных плагинов для gitsync")
        .ВерсияСреды("1.0.19")
        .ВключитьФайл("src")
        .ВключитьФайл("docs")
        .ВключитьФайл("oscript_modules")
        .ЗависитОт("logos", "0.4")
        //.ЗависитОт("v8runner", "1.0.1") // Зависимость gitsync
        //.ЗависитОт("gitrunner", "1.5.1") // Зависимость gitsync
        .ЗависитОт("strings", "0.4.1")
        .ЗависитОт("1commands", "1.3.5")
        //.ЗависитОт("v8storage") // // Зависимость gitsync
        .ОпределяетКласс("Плагин_ИнкрементальнаяВыгрузка", "src/Классы/increment.os")
        .ОпределяетКласс("Плагин_УстановкиЛимитов", "src/Классы/limit.os")
        .ОпределяетКласс("Плагин_ПроверкиАвторов", "src/Классы/check-authors.os")
        .ОпределяетКласс("Плагин_ПроверкиКомментариев", "src/Классы/check-comments.os")
        .ОпределяетКласс("Плагин_УстановкиТеговВерсий", "src/Классы/smart-tags.os")
        .ОпределяетКласс("Плагин_Tool1CD", "src/Классы/tool1CD.os")
        .ОпределяетКласс("Плагин_РаспаковкиОбычныхФорм", "src/Классы/unpackForm.os")
        .ОпределяетКласс("Плагин_СнятияСПоддержки", "src/Классы/disable-support.os")
        .ОпределяетКласс("Плагин_СинхронизацииСУдаленнымРепозиторием", "src/Классы/sync-remote.os")
        ;
